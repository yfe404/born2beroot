Ok I have my base image with disk partitionning as expected (bonus section)

Next step: setting up the ssh service running on port 4242 
note: root login must not be allowed. 

That's trivial, we just need to install `openssh-server`, edit the file `/etc/ssh/sshd_config`, 
specifically these two lines:

```
...
Port 4242
...
PermitRootLogin no
...
```

And enable the service: 
`systemctl enable --now sshd`

Easy. 

EDIT: of course we need to edit /etc/apt/sources.list first as the urls points to the cdrom (that we don't have). And run a `apt update`.

We can test that using a port forwarding in VBox (if NAT) or directlty ssh-ing the VM ip (if bridged)

-----

Next, set up of UFW, letting only traffic to and from 4242 (ssh)
Source: https://wiki.debian.org/Uncomplicated%20Firewall%20%28ufw%29

However, simply installing the firewall will not turn it on automatically, nor it will have any rule set by default.  

So we need to add our rules and enable / start the service. 

```
# ufw enable 
```

Since we use a custom port for ssh, we cannot just `ufw allow ssh`, we need to `ufw allow 4242/tcp`

------


Next step changing the hostname
Source: https://wiki.debian.org/Hostname#Core_networking


Since we use systemd this is very easy: `hostnamectl set-hostname HOSTNAME`


-------

Now let setup the password policy
Source: https://www.debian.org/doc/manuals/securing-debian-manual/ch04s11.en.html
https://web.archive.org/web/20190313211808/https://www.deer-run.com/~hal/sysadmin/pam_cracklib.html

https://www.server-world.info/en/note?os=Debian_10&p=password

We need to install the password quality checking library
`apt install libpam-pwquality`

and then edit these 2 files:
- /etc/login.defs 
- /etc/security/pwquality.conf 

according to the subject.


------


Next installation and configuration of sudo

`apt install sudo`


we can also create and add our use to sudo
`adduser foo -G sudo`

or add an existing user to sudo 
`adduser foo sudo`




Source: `man sudoers`




#### MONIT SCRIPT

For the disk usage, there a several approach and ways to compute it. For instance should the boot partition be included or not ? RAM based fs? I will choose to report only the mounted partions that uses LVM on /de/sda5 since everything is here. I will also report per partition as it makes more sense to me. 

cpu usage: https://askubuntu.com/questions/274349/getting-cpu-usage-realtime


checking if lvm is used:
pvdisplay is enough to check if you're using LVM, because it lists all physical volumes that belong to LVM.

Why it's enough:

    pvdisplay shows LVM physical volumes (PVs), which are the lowest level of LVM (typically /dev/sdX or /dev/mapper/... devices initialized for LVM).

    If you see output from pvdisplay, you are using LVM — at least one disk or partition has been initialized as a physical volume.

	[Physical Volume] -> [Volume Group] -> [Logical Volumes] -> [Mounted Filesystems]

with -q check silently 

	if sudo pvdisplay 2>/dev/null | grep -q UUID; then
    in_use=yes
fi

for counting the number of established TCP con we can use `ss` (socket statistics, modern replacement of `netstat`). 
`ss -tn state established | tail -n +2 | wc -l`
-t = TCP only
-n = don’t resolve names (faster)
state established = only show established connections
tail -n +2 = skip the header
wc -l = count the lines (i.e. number of connections)

For The number of users using the server, this it a bit vague, I will assume it is the number of users currently logged in but it might be something else... 



INSTALL OF WORDPRESS with LLMP stack ((Linux, Lighttpd, MariaDB, and PHP-FPM))
https://www.howtoforge.com/how-to-install-lighttpd-with-mariadb-and-php-fpm-on-ubuntu-22-04/
https://developer.wordpress.org/advanced-administration/before-install/howto-install/

to create the table, as root, type mariadb and follow instructions here: https://developer.wordpress.org/advanced-administration/before-install/creating-database/

creds: wordpress/password (secured I know)
